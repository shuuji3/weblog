<!doctype html><html class=no-js lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content><meta property="og:description" content><meta name=author content="map[]"><meta property="og:title" content="Play Framework using Scala"><meta property="twitter:title" content="Play Framework using Scala"><link rel=apple-touch-icon sizes=57x57 href=/images/favicons/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/favicons/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/images/favicons/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/images/favicons/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/images/favicons/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/images/favicons/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/images/favicons/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/images/favicons/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/images/favicons/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicons/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/images/favicons/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><base href=https://weblog.shuuji3.xyz/><title>Play Framework using Scala</title><link rel=canonical href=https://weblog.shuuji3.xyz/post/2021-02-12-play-framework-using-scala/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/css/Gilroy-ExtraBold.css><link rel=stylesheet href=/css/Gilroy-Light.css></head><body lang=en><div class=wrapper-masthead><div class=container><header class="masthead clearfix"><a href=https://weblog.shuuji3.xyz// class=site-avatar><img src=/images/emoji-google-unicorn-face.png></a><div class=site-info><h1 class=site-name><a href=https://weblog.shuuji3.xyz//>Weblog by shuuji3</a></h1><p class=site-description>Software Engineering</p></div><nav><a href=/>Blog</a>
<a href=/project>Projects</a>
<a href=/dashboard/blog>Dashboard</a></nav></header></div></div><div class=container><section class=section><div class=container><article class=article><h1 class=title><a href=https://weblog.shuuji3.xyz/post/2021-02-12-play-framework-using-scala/>Play Framework using Scala</a></h1><div class=post-metadata><p class=text-muted></p><div class="tags text-muted"><i class="fa fa-tags" aria-hidden=true></i><a class="button is-link code" href=/tags/scala>scala</a>
<a class="button is-link code" href=/tags/play-framework>play-framework</a>
<a class="button is-link code" href=/tags/watching>watching</a></div><p class=text-muted><i class="fa fa-calendar" aria-hidden=true></i>February 12, 2021</p></div><div class=content><div class="well post-banner"></div><div class="table-of-contents toc bd-callout"><h4 class=text-muted>Table of Contents</h4><ul class=toc-h1><ul class=toc-h2><li><a href=/post/2021-02-12-play-framework-using-scala/#01-playlist-introduction>01. Playlist Introduction</a></li></ul></ul><ul class=toc-h1><ul class=toc-h2><ul class=toc-h3><li><a href=/post/2021-02-12-play-framework-using-scala/#%e5%85%ac%e5%bc%8f%e3%82%b5%e3%82%a4%e3%83%88%e3%81%ae%e7%a2%ba%e8%aa%8d%e3%81%a8the-reactive-manifesto>公式サイトの確認とThe Reactive Manifesto</a></li></ul></ul></ul><ul class=toc-h1><ul class=toc-h2><ul class=toc-h3><li><a href=/post/2021-02-12-play-framework-using-scala/#%e3%83%93%e3%83%ab%e3%83%87%e3%82%a3%e3%83%b3%e3%82%b0%e3%83%96%e3%83%ad%e3%83%83%e3%82%af-akka-http>ビルディングブロック Akka HTTP</a></li></ul></ul></ul><ul class=toc-h1><ul class=toc-h2><li><a href=/post/2021-02-12-play-framework-using-scala/#02-structure-of-our-play-project>02. Structure of our Play Project</a></li></ul></ul><ul class=toc-h1><ul class=toc-h2><ul class=toc-h3><li><a href=/post/2021-02-12-play-framework-using-scala/#%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%ae%e3%82%a4%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%88>プロジェクトのインポート</a></li></ul></ul></ul><ul class=toc-h1><ul class=toc-h2><ul class=toc-h3><li><a href=/post/2021-02-12-play-framework-using-scala/#%e3%83%87%e3%82%a3%e3%83%ac%e3%82%af%e3%83%88%e3%83%aa%e6%a7%8b%e6%88%90%e3%81%ae%e7%a2%ba%e8%aa%8d>ディレクトリ構成の確認</a></li></ul></ul></ul><ul class=toc-h1><ul class=toc-h2><ul class=toc-h3><li><a href=/post/2021-02-12-play-framework-using-scala/#%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%81%ae%e8%b5%b7%e5%8b%95%e3%81%a8%e9%9d%99%e7%9a%84%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%ae%e8%a1%a8%e7%a4%ba>サーバーの起動と静的ファイルの表示</a></li></ul></ul></ul><ul class=toc-h1><ul class=toc-h2><li><a href=/post/2021-02-12-play-framework-using-scala/#03-making-our-first-page-with-play-using-scala>03. Making Our First Page with Play using Scala</a></li></ul></ul><ul class=toc-h1><ul class=toc-h2><ul class=toc-h3><li><a href=/post/2021-02-12-play-framework-using-scala/#index-view%e3%81%ae%e7%a2%ba%e8%aa%8d>index viewの確認</a></li></ul></ul></ul><ul class=toc-h1><ul class=toc-h2><ul class=toc-h3><li><a href=/post/2021-02-12-play-framework-using-scala/#%e6%96%b0%e3%81%97%e3%81%84%e3%82%b3%e3%83%b3%e3%83%88%e3%83%ad%e3%83%bc%e3%83%a9%e3%83%bctasklist1%e3%81%ae%e4%bd%9c%e6%88%90>新しいコントローラーTaskList1の作成</a></li></ul></ul></ul><ul class=toc-h1><ul class=toc-h2><ul class=toc-h3><li><a href=/post/2021-02-12-play-framework-using-scala/#%e4%be%9d%e5%ad%98%e6%80%a7%e3%81%ae%e6%b3%a8%e5%85%a5dependency-injection>依存性の注入（Dependency Injection）</a></li></ul></ul></ul><ul class=toc-h1><ul class=toc-h2><ul class=toc-h3><li><a href=/post/2021-02-12-play-framework-using-scala/#action%e3%81%ae%e5%ae%9a%e7%be%a9%e3%81%a8%e3%83%98%e3%83%ab%e3%83%91%e3%83%bc%e9%96%a2%e6%95%b0todo%e3%81%ae%e6%b4%bb%e7%94%a8>Actionの定義とヘルパー関数TODOの活用</a></li></ul></ul></ul></div><p>この記事では、テキサスのTrynity Universityの教授Mark C. LewisさんがYouTubeで公開している「Play Framework using Scala」をハンズオンで進めながら、やったことや理解したことなどをメモしています。</p><p>Mark Lewisさんは、スーパーコンピュータなどで天文学のシミュレーションなどをしているそうです。Scalaを使ったプログラミングやウェブ開発やビッグデータ処理の講義をしていて、授業前に学生が見るビデオをYouTubeで公開してくれています。</p><p>私が知ったきっかけは、LightbendのPodcastの「<a href=https://www.lightbend.com/blog/teaching-scala>Teaching Scala To Computer Science 101 Students | @lightbend</a>」というエピソードです。CS 101の動画だけでなく、Play Frameworkの動画があることを知りました。前からPlay Frameworkは気になっていて知りたかったので、見てみることにしました。</p><h2 id=01-playlist-introduction>01. Playlist Introduction</h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/FqMDHsFNlxQ style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h3 id=公式サイトの確認とthe-reactive-manifesto>公式サイトの確認とThe Reactive Manifesto</h3><ul><li>はじめに公式サイトを見ました。<ul><li><a href=https://www.playframework.com/>Play Framework - Build Modern & Scalable Web Apps with Java and Scala</a></li></ul></li><li>一番の特徴はReactiveであることだと言います。これは、The Reactive Manifestoの考えに基づいています。<ul><li>Note: アジャイルマニフェストのような<a href=https://www.reactivemanifesto.org/>The Reactive Manifesto</a>というものがあることを初めて知りました。日本語翻訳もあります。応答性に優れた分散システムの特徴について説明したもののようです。要約すると次のように説明できます。<ul><li>優れた分散システムは、メッセージ駆動をベースとし、大量の要求に対してelastic(scalable)であるべきであり、障害に対してresilientであるべきである。その結果、responsiveという価値を実現することができる。</li><li>Note: 全体的に主張していることが、今読んでいる「Designing Data-Intensive Applications」での議論に非常に近い気がしました。</li></ul></li></ul></li></ul><h3 id=ビルディングブロック-akka-http>ビルディングブロック Akka HTTP</h3><ul><li>Play Frameworkビルディングブロックとして、
Scalaの非同期ウェブサーバーのライブラリ<a href=https://doc.akka.io/docs/akka-http/current/index.html>Akka HTTP</a>を利用している。</li></ul><h2 id=02-structure-of-our-play-project>02. Structure of our Play Project</h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/S_NE53AM2F4 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h3 id=プロジェクトのインポート>プロジェクトのインポート</h3><ul><li>Mark Lewisさんが用意した<a href=https://github.com/MarkCLewis/Play-Videos/tree/a0de3a89164aaa7f9a6a1c2604b4bf561657c935>Play-Video</a>とよばれるPlayのプロジェクトを使用します。</li><li>はじめに、ビデオではEclipseでプロジェクトをimportしています。<ul><li>Server、Client、Shareのコンポーネントからなるプロジェクトです。Eclipseでは、4つのコンポーネントが認識されているため、1つを除外する必要があります<ul><li>Note: 私はいつも使っているIntelliJ IDEAでGitHubのリポジトリのURLからプロジェクトをロードしました。この場合は、正しく3つのコンポーネントが認識されました。</li><li>Note: IntelliJ IDEAでScalaの開発をするときに素晴らしいところは、project.sbtの存在から自動的にsbtプロジェクトであることを認識してくれることです。そして、プロジェクトにふさわしい適正なバージョンのScalaとsbtをインストールしてくれ、依存関係のライブラリもivyを使って自動的にインストールしてくれます。素晴らしいです。</li><li>Note: ただし、今回のプロジェクトでは初期セットアップに結構時間がかかりました。完了までに9 min 42 secかかりました。</li></ul></li></ul></li></ul><h3 id=ディレクトリ構成の確認>ディレクトリ構成の確認</h3><ul><li>プロジェクトをロードしたら、まずは、<code>server</code>ディレクトリを概観します。このディレクトリには次のように4つのディレクトリが存在します。重要なものだけ見ていきます。<ul><li><code>app/</code>: MVCフレームワークのコントローラーとビューに相当するファイルが格納されています。</li><li><code>conf/</code>:<ul><li><code>application.conf</code>: アプリケーション全体の設定ファイルです。<ul><li>Note: 私は設定ファイルが同じような名前のRuby on Railsを思い出しました。</li></ul></li><li><code>routes</code>: ルーターが定義されています。ルーターでは、HTTPのメソッド・パスのペアからコントローラーへのマッピングが定義されます。</li></ul></li><li><code>public/</code>: 静的ファイルが配置されます。</li><li><code>test/</code>: テストを書いたSpecファイルが格納されています。<ul><li>Note: <code>play.api.test</code> というライブラリがimportされています。Playは内部に専用の便利なテスト用ライブラリを持っているようです。</li></ul></li></ul></li></ul><h3 id=サーバーの起動と静的ファイルの表示>サーバーの起動と静的ファイルの表示</h3><ul><li>サーバーを起動する<ul><li>サーバーを起動するには、<code>sbt run</code>を実行します。ビデオでは、<code>sbt</code>でインタラクティブシェルの世界に入り、その中で<code>run</code>コマンドを実行しています。</li><li><code>localhost:9000</code>でサーバーが起動します。</li><li>Note: DjangoやRuby on Railsでは、ふつう、開発専用のサーバーが起動します。このサーバーも開発用のものなのでしょうか？ ルーティングできないページを表示すると、routerのregexリストが表示されたので、やはりそのようです。</li></ul></li><li>ルーターの設定を確認する<ul><li><code>conf/routes</code>ファイルを確認すると、<code>GET /assets/*file controllers.Assets.at(file)</code>という定義があります。これが静的ファイルの配信を定義しているルートです。<ul><li>Note: <code>*file</code>は変数を定義していて、コントローラーハンドラに渡せるようになっているみたいですね。</li></ul></li></ul></li><li>ブラウザで確認する<ul><li><code>public/</code>ディレクトリにある静的ファイルを表示します。</li><li>http://localhost:9000/assets/basicStuff.html を開くと、「This is a basic HTML file.」と表示されました。実際に、<code>public/basicStuff.html</code>がサーバーから配信されました！</li></ul></li></ul><h2 id=03-making-our-first-page-with-play-using-scala>03. Making Our First Page with Play using Scala</h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/YhOOnE4_KWA style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h3 id=index-viewの確認>index viewの確認</h3><p><code>index.scala.html</code>は次のように定義されています。</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=o>@(</span><span class=n>message</span><span class=k>:</span> <span class=kt>String</span><span class=o>)</span>

<span class=nd>@main</span><span class=o>(</span><span class=s>&#34;Play with Scala.js&#34;</span><span class=o>)</span> <span class=o>{</span>
<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=nc>Play</span> <span class=n>and</span> <span class=nc>Scala</span><span class=o>.</span><span class=n>js</span> <span class=n>share</span> <span class=n>a</span> <span class=n>same</span> <span class=n>message</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>

<span class=o>&lt;</span><span class=n>ul</span><span class=o>&gt;</span>
  <span class=o>&lt;</span><span class=n>li</span><span class=o>&gt;</span><span class=nc>Play</span> <span class=n>shouts</span> <span class=n>out</span><span class=k>:</span> <span class=kt>&lt;em&gt;@message&lt;/em&gt;&lt;/li&gt;</span>
<span class=o>...</span>
<span class=o>}</span>
</code></pre></div><p>viewの1行目はパラメータを指定しています。ここでは1つのStringを指定しています。</p><p>テンプレート内では、<code>@message</code>のように、<code>@</code>プリフィックスを付けて変数を参照できます。普通のテンプレートエンジンですね。</p><p>面白いのは、<code>@main</code>です。同じディレクトリにある以下のような<code>main.scala.html</code>を、2つの引数を渡して呼び出しています。</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=o>@(</span><span class=n>title</span><span class=k>:</span> <span class=kt>String</span><span class=o>)(</span><span class=n>content</span><span class=k>:</span> <span class=kt>Html</span><span class=o>)</span>

<span class=o>&lt;!</span><span class=nc>DOCTYPE</span> <span class=n>html</span><span class=o>&gt;</span>

<span class=o>&lt;</span><span class=n>html</span><span class=o>&gt;</span>
  <span class=o>&lt;</span><span class=n>head</span><span class=o>&gt;</span>
    <span class=o>&lt;</span><span class=n>title</span><span class=o>&gt;@</span><span class=n>title</span><span class=o>&lt;/</span><span class=n>title</span><span class=o>&gt;</span>
<span class=o>...</span>
  <span class=o>&lt;</span><span class=n>body</span><span class=o>&gt;</span>
    <span class=nd>@content</span>
<span class=o>...</span>
</code></pre></div><p>1行目にパラメータが2つ定義されています。1つの括弧内に2つのパラメータを並べるのではなく、カリー化を使用して2つの括弧で2階の関数のように定義されています。ユニークで面白いです。</p><p>2つ目の引数には、<code>{}</code>で包んだHTMLが渡されていました。この構文は、Play Framefork内でHtml型のオプジェクトに変換する糖衣構文として実装されているような気がします。変数と同じように埋め込むと、有効なHTMLとして展開されるようです。これも面白いです。</p><h3 id=新しいコントローラーtasklist1の作成>新しいコントローラーTaskList1の作成</h3><p>次のようなファイルを作成して、TaskList1というコントローラーを作成しました。</p><div class=highlight><pre class=chroma><code class=language-scala data-lang=scala><span class=k>package</span> <span class=nn>controllers</span>

<span class=k>import</span> <span class=nn>javax.inject._</span>

<span class=k>import</span> <span class=nn>play.api.mvc._</span>
<span class=k>import</span> <span class=nn>play.api.i18n._</span>

<span class=nd>@Singleton</span>
<span class=k>class</span> <span class=nc>TaskList1</span>  <span class=nd>@Inject</span><span class=o>()(</span><span class=n>cc</span><span class=k>:</span> <span class=kt>ControllerComponents</span><span class=o>)</span> <span class=k>extends</span> <span class=nc>AbstractController</span><span class=o>(</span><span class=n>cc</span><span class=o>)</span> <span class=o>{</span>
  <span class=k>def</span> <span class=n>taskList</span> <span class=k>=</span> <span class=nc>Action</span> <span class=o>{</span>
    <span class=nc>Ok</span><span class=o>(</span><span class=s>&#34;This works!&#34;</span><span class=o>)</span>
  <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><h3 id=依存性の注入dependency-injection>依存性の注入（Dependency Injection）</h3><p><code>@Singleton</code>は依存性注入のために必要なデコレーターらしいです。</p><p><code>javax.inject</code>ライブラリをimportして、インジェクションを行えるようにしています。<code>AbstractController</code>に<code>cc</code>を注入して、これを継承した<code>TaskList1</code>という新しいコントローラーを定義しています。</p><p>Note: 私は<a href=https://ja.wikipedia.org/wiki/%E4%BE%9D%E5%AD%98%E6%80%A7%E3%81%AE%E6%B3%A8%E5%85%A5>依存性の注入（DI）</a>を活用するフレームワークを使った経験がAngularで少し触れた程度しかないので、雰囲気が少しわかるという程度の理解しかありません。もっと学習が必要です。</p><h3 id=actionの定義とヘルパー関数todoの活用>Actionの定義とヘルパー関数<code>TODO</code>の活用</h3><p>次に、Actionを定義します。Actionは、<code>router</code>でルートの3列目に定義されていた関数です。ここで、ルートからパラメータを受け取れます。</p><p><code>play.api.mvc.TODO</code>というヘルパー関数があり、実装前のActionの代わりに<code>def taskList = TODO</code>のように指定できます。こうすると、ページにアクセスしたときに未実装であることを示すTODOページが表示されます。便利です。</p><p><code>TODO</code>を<code>Action { Ok("This works!") }</code>で置き換えると、HTTP 200 OKのステータスを持ち、Bodyが文字列<code>This works!</code>であるようなHTTPレスポンスが返されます。</p><p>次のビデオでは、単純な文字列だけでなく、viewを作成していきます。</p></div></article></div></section></div><div class=container><div class=pagination><a class="btn btn-secondary pull-right" href=https://weblog.shuuji3.xyz/post/centos8-firewall-cmd/><i class="fa fa-chevron-left" aria-hidden=true></i>Previous</a>
<button type=button class="btn btn-secondary pull-left disabled">Next <i class="fa fa-chevron-right" aria-hidden=true></i></button></div></div><div class=wrapper-footer><div class=container><footer class=footer><img src=/images/powered-by-hugo.svg alt="powered by hugo"></img></footer></div></div><script src=/js/dist/vendor/jquery/jquery.min.js></script><script src=/js/dist/vendor/tether/tether.min.js></script><script src=/js/dist/vendor/bootstrap/bootstrap.min.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-7053288-5','auto');ga('send','pageview');}</script></body></html>